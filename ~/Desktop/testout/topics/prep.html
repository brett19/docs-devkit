<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Couchbase Server product documentation"><style>
					body{
						padding-top:60px; /* make the container go all the way to the bottom of the top bar */
					}</style><link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet"></head><body><header class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><div class="container-fluid container"><a class="brand" href="/">Couchbase Documentation</a></div></div></header><div id="content" class="container-fluid container"><div class="row-fluid"><nav class="span3"><div class="well"><ul class="nav nav-list"><li><a href="../topics/intro.html">Introduction</a></li><li><a href="../topics/getting-started.html">Getting Started</a></li><li><a href="../topics/tutorial-intro.html">Tutorial</a><ul class="nav nav-list"><li><a href="../topics/tutorial-intro.html">Tutorial</a></li><li><a href="../topics/quick-start.html">Quick start</a></li><li class="active"><a href="../topics/prep.html">Preparations</a><ul class="nav nav-list"></ul></li><li><a href="../topics/wecome.html">The Welcome Page</a></li><li><a href="../topics/manage-beers.html">Managing Beers</a></li><li><a href="../topics/tutorial-wrap.html">Wrapping Up</a></li></ul></li><li>Advanced usage</li><li>Using the APIs</li></ul></div></nav><main class="span9">
	<h1 class="title topictitle1">Preparations</h1>

	<div class="body conbody">

		<div class="section"><h2 class="title sectiontitle">Project Setup</h2>
			
			<p class="p">In this section we’ll talk a bit about setting up your directory layout and adding some
				views in the server before we start dealing with the Node.js SDK and express+jade
				itself.</p>

			<p class="p">Create a project directory named <span class="ph filepath">beer</span>:</p>

			<pre class="pre codeblock">
shell&gt; mkdir beer 
shell&gt; cd beer 
shell&gt; mkdir views 
shell&gt; mkdir views/beer 
shell&gt; mkdir views/brewery 
shell&gt; mkdir static 
shell&gt; mkdir static/js 
shell&gt; mkdir static/css
</pre>

			<p class="p">Showing your directory contents displays something like this:</p>

			<pre class="pre codeblock">
shell&gt; find . -type d
./static
./static/js
./static/css
./views
./views/brewery
./views/beer
</pre>

			<p class="p">To make the application look pretty, we’re incorporating jQuery and Twitter Bootstrap.
				You can either download the libraries and put them in their appropriate
					<span class="ph filepath">css</span> and <span class="ph filepath">js</span> directories (under
					<span class="ph filepath">static</span>), or clone the project repository and use it from there.
				If you followed the quick start steps, you already have the files in your
					<span class="ph filepath">beersample-node</span> directory. Either way, make sure you have the
				following files in place:</p>

			<ul class="ul">
				<li class="li"><span class="ph filepath">static/css/beersample.css</span></li>

				<li class="li"><span class="ph filepath">static/css/bootstrap.min.css</span> (the minified Twitter Bootstrap
					library)</li>

				<li class="li"><span class="ph filepath">static/css/bootstrap-responsive.min.css</span> (the minified responsive layout
					classes from Bootstrap)</li>

				<li class="li"><span class="ph filepath">static/js/beersample.js</span></li>

				<li class="li"><span class="ph filepath">static/js/jquery.min.js</span> (the jQuery JavaScript library)</li>

			</ul>

			<p class="p">From here on, you should have a bare bones web application configured that has all the
				dependencies included. We’ll now move on and configure the beer-sample bucket the way we
				need it. </p>

		</div>


		<div class="section"><h2 class="title sectiontitle">Preparing the Views</h2><p class="p">The beer-sample bucket comes with a small set of
				predefined views, but to make our application function correctly we need some more. This
				is also a good chance to explore the view management possibilities inside the
				Web-UI.</p>
<p class="p">Because we want to list beers and breweries by name, we need to define one
				view for each. Head over to the Web-UI and click on the Views menu. Select beer-sample
				from the drop-down list to switch to the correct bucket. Now click on Development Views
				and then Create Development View to define your first view. You need to give it the name
				of both the design document and the actual view. Insert the following names:</p>
<ul class="ul">
				<li class="li"><p class="p">Design Document Name: _design/dev_beer</p>
</li>

				<li class="li"><p class="p">View Name: by_name</p>
</li>

			</ul>
<p class="p">The next step is to define the map and (optional) reduce functions. In our
				examples, we won’t use the reduce functions at all but you can play around and see what
				happens. Insert the following map function (that’s JavaScript) and click
				Save.</p>
<pre class="pre codeblock"><samp class="ph codeph">function (doc, meta) {
  if(doc.type &amp;&amp; doc.type == "beer") {
    emit(doc.name, null);
  }
}
</samp></pre>
<p class="p">Every
				map function takes the full document (doc) and its associated metadata (meta) as the
				arguments. You are then free to inspect this data and emit a result when you want to
				have it in your index. In our case, we emit the name of the beer (doc.name) when the
				document both has a type field and the type is beer. We don’t need to emit a value —
				that’s why we are using null here. It’s always advisable to keep the index as small as
				possible. Resist the urge to include the full document through emit(meta.id, doc),
				because it will increase the size of your view indexes. If you need to access the full
				document you can call db.get(result.key) to get the individual doc for a single row. The
				resulting retrieval of the document might be slightly out of sync with your view, but it
				will be fast and efficient.</p>
<p class="p">Now we need to define a view for our breweries. You
				already know how to do this — here is all the information you need to create a brewery
				view:</p>
<ul class="ul">
				<li class="li"><p class="p">Design Document Name: _design/dev_brewery</p>
</li>

				<li class="li"><p class="p">View Name: by_name</p>
</li>

				<li class="li"><p class="p">Map Function:</p>

					<pre class="pre codeblock"><samp class="ph codeph">function (doc, meta) {
  if(doc.type &amp;&amp; doc.type == "brewery") {
    emit(doc.name, null);
  }
}
</samp></pre>
</li>

			</ul>
<p class="p">The final step is to push the design documents in production. While the design
				documents are in development, the index is applied only to a deterministic subset of the
				data. Because we want to have the index on the whole data set, click the Publish button
				on both design documents (and accept any pop-up windows that warn you about overriding
				the old design documents).</p>
<p class="p">For more information about using views for indexing and
				querying from Couchbase Server, see the following helpful resources in the Couchbase
				Server Manual:</p>
<ul class="ul">
				<li class="li"><p class="p">General information: <a class="xref" href="http://www.couchbase.com/docs/couchbase-manual-2.1.0/couchbase-views.html" target="_blank">Views and Indexes</a></p>
</li>

				<li class="li"><p class="p">Sample patterns: <a class="xref" href="http://www.couchbase.com/docs/couchbase-manual-2.1.0/couchbase-views-sample-patterns.html" target="_blank">View and Query Pattern Samples</a></p>
</li>

				<li class="li"><p class="p">Time stamp patterns: Many developers ask about extracting information based on
						date or time. To find out more, see <a class="xref" href="http://www.couchbase.com/docs/couchbase-manual-2.1.0/couchbase-views-sample-patterns-timestamp.html" target="_blank">Date and Time Selection</a></p>
</li>

			</ul>
</div>

	</div>


<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../topics/tutorial-intro.html">Tutorial</a></div>
</div>
</div></main></div></div><hr><footer><p style="text-align: center;">copyright 2014 <a href="http://www.couchbase.com/">Couchbase</a></p></footer><script src="http://code.jquery.com/jquery-1.9.1.min.js"></script><script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script></body></html>